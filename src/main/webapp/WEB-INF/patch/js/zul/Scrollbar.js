(function(b){function c(i,e,d){var g=d==0,h=i.$n(e),j=i.$n(e+"-embed"),f;if(h){f=h.style;f.display=g?"none":"block";f.opacity=d;if(b.ie<9){f.filter="alpha(opacity="+100*d+")"}}if(j){f=j.style;f.display="block";f.opacity=g?0.2:0;if(b.ie<9){f.filter=g?"alpha(opacity=20)":"alpha(opacity=0)"}}}function a(e,f,d){if(f>d){return e}if(e<f){e=f}if(e>d){e=d}return e}zul.Scrollbar=b.$extends(b.Object,{_pos:null,_barPos:null,_pressTimer:null,_frozenScroll:0,_frozenLimit:false,$n:function(d){return jq(this.uid+"-"+d,b)[0]},$init:function(g,d,f){if(!g||!d){throw"Both wrapper and scroller dom element are required to generate scrollbar"}this.cave=g;var e=g.style;e.position="relative";e.overflow="hidden";this.scroller=d;this.opts=b.$default(f,{embed:false,step:20,wheelAmountStep:3,startPositionX:0,startPositionY:0});this.widget=b.Widget.$(g);this.uid=this.widget.uuid;this._pos=[0,0];this._barPos=[0,0];this.currentPos={x:this._pos[0],y:this._pos[1]};jq(g).bind("scroll",this.proxy(this._fixScroll)).bind("mouseenter",this.proxy(this._mouseEnter)).bind("mouseleave",this.proxy(this._mouseLeave))},destroy:function(){var d=this.cave;jq(d).unbind("scroll",this.proxy(this._fixScroll)).unbind("mouseenter",this.proxy(this._mouseEnter)).unbind("mouseleave",this.proxy(this._mouseLeave));this._unbindMouseEvent("hor");this._unbindMouseEvent("ver");jq(this.$n("hor")).remove();jq(this.$n("ver")).remove();this._pos=this._barPos=this.currentPos=null},hasVScroll:function(){return this.needV},hasHScroll:function(){return this.needH},syncSize:function(d){this._checkBarRequired();var r=this.widget,I=r.frozen,D=0,N=r.$n("tpad"),B=r.$n("bpad"),L=this.cave,q=this.scroller,z=this.$n("hor"),j=this.$n("ver"),l=this.needH,f=this.needV,A=this.opts,s=q.scrollHeight;if(N&&B){s+=N.offsetHeight+B.offsetHeight}if(I){D=50*(I._scrollScale||0)}if(l){var M=z.style.display;z.style.display="block";var H=this.$n("hor-embed"),g=this.$n("hor-left"),J=this.$n("hor-right"),u=this.$n("hor-wrapper"),O=u.style,w=A.startPositionX,y=L.offsetWidth-w,G=z.offsetHeight+q.scrollWidth-w+D,K=g.offsetWidth,n=J.offsetWidth,h=y-K-n;if(G<y){G=y+D}if(w){g.style.left=jq.px(w);O.left=jq.px(w+K);if(H){H.style.left=jq.px(w)}}if(f){O.width=jq.px(h-n);J.style.right=jq.px(n)}else{O.width=jq.px(h)}var F=this.$n("hor-indicator"),o=u.offsetWidth,C=Math.round(o*y/G),C=C>15?C:15;F.style.width=C+"px";if(H){H.style.width=(C+K+n)+"px"}this.hLimit=G-y;var v=o-C;if(v<=0){this.hBarLimit=0;F.style.display="none"}else{this.hBarLimit=v}this.hRatio=Math.abs(this.hLimit/this.hBarLimit);z.style.display=M}if(f){var M=j.style.display;j.style.display="block";var H=this.$n("ver-embed"),E=this.$n("ver-up"),i=this.$n("ver-down"),u=this.$n("ver-wrapper"),O=u.style,t=A.startPositionY,k=L.offsetHeight-t,x=j.offsetWidth+s-t,m=E.offsetHeight;dhgh=i.offsetHeight,vhgh=k-m-dhgh;if(t){j.style.top=jq.px(L.offsetTop+t);i.style.bottom=jq.px(t);if(H){H.style.top=j.style.top}}if(l){O.height=jq.px0(vhgh-dhgh);i.style.bottom=jq.px(t+dhgh)}else{O.height=jq.px(vhgh)}var F=this.$n("ver-indicator"),e=u.offsetHeight,p=Math.round(e*k/x),p=p>15?p:15;F.style.height=p+"px";if(H){H.style.height=(p+m+dhgh)+"px"}this.vLimit=x-k;var v=e-p;if(v<=0){this.vBarLimit=0;F.style.display="none"}else{this.vBarLimit=v}this.vRatio=Math.abs(this.vLimit/this.vBarLimit);j.style.display=M}this.scrollTo(this._pos[0],this._pos[1]);if(d){c(this,"hor",1);c(this,"ver",1)}},scrollTo:function(d,f){if(this.needH){d=a(d,0,this.hLimit);var e=d/this.hRatio;this._syncPosition("hor",d);this._syncBarPosition("hor",e);this._syncEmbedBarPosition("hor",d+e)}if(this.needV){f=a(f,0,this.vLimit);var e=f/this.vRatio;this._syncPosition("ver",f);this._syncBarPosition("ver",e);this._syncEmbedBarPosition("ver",f+e)}this._onScrollEnd()},scrollToElement:function(l){var q=this.cave,m=jq(l).offset().top,o=m+l.offsetHeight,j=jq(l).offset().left,k=j+l.offsetWidth,i=jq(q).offset().top,n=i+q.offsetHeight,r=jq(q).offset().left,h=r+q.offsetWidth;scrollUp=true,scrollLeft=l.offsetWidth==q.offsetWidth;if((this.needV&&o<=n&&m>=i)||(this.needH&&k<=h&&j>=r)){return}if(m<i){scrollUp=false}if(j<r){scrollLeft=false}var f=scrollUp?o-n:i-m,d=this._pos[1]+(scrollUp?f:-f),g=scrollLeft?k-h:r-j,e=this._pos[0]+(scrollLeft?g:-g),p;if(this.needV){d=a(d,0,this.vLimit);p=d/this.vRatio;this._syncPosition("ver",d);this._syncBarPosition("ver",p);this._syncEmbedBarPosition("ver",d+p)}if(this.needH){e=a(e,0,this.hLimit);p=e/this.hRatio;this._syncPosition("hor",e);this._syncBarPosition("hor",p);this._syncEmbedBarPosition("hor",e+p)}this._onScrollEnd();b(l).scrollIntoView()},isScrollIntoView:function(h){var l=this.cave,i=jq(h).offset().top,k=i+h.offsetHeight,f=jq(h).offset().left,g=f+h.offsetWidth,e=jq(l).offset().top,j=e+l.offsetHeight,m=jq(l).offset().left,d=m+l.offsetWidth;if((this.needV&&k<=j&&i>=e)||(this.needH&&g<=d&&f>=m)){return true}else{return false}},getCurrentPosition:function(){return this.currentPos},setBarPosition:function(g){var f=this.widget.frozen;if(f&&this.needH){var d=this.hBarLimit/f._scrollScale,e=g*d;this._syncBarPosition("hor",e);this._syncEmbedBarPosition("hor",e)}},_checkBarRequired:function(){var h=this.cave,d=this.scroller,g=this.widget.frozen;this.needH=g?true:(h.offsetWidth<d.scrollWidth);var e=this.$n("hor");if(!this.needH){if(e){this._unbindMouseEvent("hor");this._syncPosition("hor",0);jq(e).remove()}}else{if(!this.$n("hor")){this.redraw(h,"hor");this._bindMouseEvent("hor")}}this.needV=h.offsetHeight<d.offsetHeight;var f=this.$n("ver");if(!this.needV){if(f){this._unbindMouseEvent("ver");this._syncPosition("ver",0);jq(f).remove()}}else{if(!f){this.redraw(h,"ver");this._bindMouseEvent("ver")}}},_bindMouseEvent:function(f){var l=this,k=l.cave,i=f=="hor",g=l.$n(f),e=l.$n(f+"-indicator"),d=l.$n(f+"-rail"),j=l.$n(f+(i?"-left":"-up")),h=l.$n(f+(i?"-right":"-down"));if(i&&(!(b.ie<11)||!b.opera)){jq(k).mousewheel(l.proxy(l._mousewheelX))}else{jq(k).mousewheel(l.proxy(l._mousewheelY))}jq(g).click(b.$void);jq(e).bind("mousedown",l.proxy(l._dragStart));jq(d).bind("mousedown",l.proxy(l._mouseDown)).bind("mouseup",l.proxy(l._mouseUp));jq(j).bind("mousedown",l.proxy(l._mouseDown)).bind("mouseup",l.proxy(l._mouseUp));jq(h).bind("mousedown",l.proxy(l._mouseDown)).bind("mouseup",l.proxy(l._mouseUp))},_unbindMouseEvent:function(f){var l=this,k=l.cave,i=f=="hor",g=l.$n(f),e=l.$n(f+"-indicator"),d=l.$n(f+"-rail"),j=l.$n(f+(i?"-left":"-up")),h=l.$n(f+(i?"-right":"-down"));if(i&&(!(b.ie<11)||!b.opera)){jq(k).unmousewheel(l.proxy(l._mousewheelX))}else{jq(k).unmousewheel(l.proxy(l._mousewheelY))}jq(g).unbind("click",b.$void);jq(e).unbind("mousedown",l.proxy(l._dragStart));jq(d).unbind("mousedown",l.proxy(l._mouseDown)).unbind("mouseup",l.proxy(l._mouseUp));jq(j).unbind("mousedown",l.proxy(l._mouseDown)).unbind("mouseup",l.proxy(l._mouseUp));jq(h).unbind("mousedown",l.proxy(l._mouseDown)).unbind("mouseup",l.proxy(l._mouseUp))},_fixScroll:function(d){var e=this.cave;if(!this.dragging){this.scrollTo(e.scrollLeft,e.scrollTop)}},_mouseEnter:function(d){c(this,"hor",1);c(this,"ver",1)},_mouseLeave:function(d){if(this.dragging){return}c(this,"hor",0);c(this,"ver",0)},_dragStart:function(e){if(this._pressTimer){clearInterval(this._pressTimer);this._pressTimer=null}e.preventDefault();var f=this,g=f.$n("hor-indicator")==e.currentTarget?"hor":"ver",h=g=="hor",d=h?e.pageX:e.pageY,j=h?f._barPos[0]:f._barPos[1],i={orient:g,point:d,pos:j};jq(document).bind("mousemove",i,f.proxy(f._dragMove)).bind("mouseup",f.proxy(f._dragEnd))},_dragEnd:function(e){var f=this,d=e.pageX,j=e.pageY,i=f.cave,h=jq(i).offset().left,g=jq(i).offset().top;jq(document).unbind("mousemove",f.proxy(f._dragMove)).unbind("mouseup",f.proxy(f._dragEnd));f.dragging=false;if((d<h||d>h+i.offsetWidth)||(j<g||j>g+i.offsetHeight)){c(f,"hor",0);c(f,"ver",0)}},_dragMove:function(n){var h=n.data,g=h.orient,l=h.point,k=h.pos,o=g=="hor",m=(o?n.pageX:n.pageY)-l,j=k+m,f=o?this.hBarLimit:this.vBarLimit,i=o?this.hRatio:this.vRatio,d=this.widget.frozen;this.dragging=true;j=a(j,0,f);this._syncBarPosition(g,j);if(d&&o){var e=f/d._scrollScale;d._doScroll(j/e);this._syncEmbedBarPosition("hor",j)}else{var k=j*i;this._syncPosition(g,k);this._syncEmbedBarPosition(g,k+j);this._onScrollEnd()}},_mousewheelX:function(l,k,h,g){var e=this.opts,f=e.step*e.wheelAmountStep,j=this._pos[0];if(h){l.stop();j+=(h>0?-f:f);j=a(j+f,0,this.hLimit);var d=this.widget.frozen,i=j/this.hRatio;if(d){f=this.hBarLimit/d._scrollScale;i=i/f;d._doScroll(i);this._syncEmbedBarPosition("hor",i)}else{this._syncPosition("hor",j);this._syncEmbedBarPosition("hor",j+i)}this._syncBarPosition("hor",i);this._onScrollEnd()}},_mousewheelY:function(l,k,h,g){var d=this.opts,f=d.step*d.wheelAmountStep,j=this._pos[1],i;if(g){var e=g>0;if(e&&j==0){return}if(!e&&j==this.vLimit){return}l.stop();j+=(e?-f:f);j=a(j,0,this.vLimit);i=j/this.vRatio;this._syncPosition("ver",j);this._syncBarPosition("ver",i);this._syncEmbedBarPosition("ver",j+i);this._onScrollEnd()}},_mouseUp:function(d){clearInterval(this._pressTimer);this._pressTimer=null},_mouseDown:function(s){if(this._pressTimer){clearInterval(this._pressTimer);this._pressTimer=null}var A=s.currentTarget,r=this.$n("hor-rail"),f=this.$n("ver-rail"),o=this.$n("ver-up"),q=this.$n("ver-down"),h=this.$n("hor-left"),z=this.$n("hor-right"),y=this.widget.frozen,w=this.hBarLimit,k=y?w/y._scrollScale:this.opts.step;if(A==r||A==f){var e=A==r,p=e?"hor":"ver",i=jq(A).offset(),i=e?i.left:i.top,n=this.$n(p+"-indicator"),d=e?n.offsetWidth:n.offsetHeight,v=(e?s.pageX:s.pageY)-i-d/2,x=e?this.hLimit:this.vLimit,l=e?this.hRatio:this.vRatio,j=e?this._pos[0]:this._pos[1],m=e?this._barPos[0]:this._barPos[1],g=v*l,u=k*10;t=this;if(y){v=a(v,0,w);t._syncBarPosition("hor",v);t._syncEmbedBarPosition("hor",v);y._doScroll(v/k)}else{t._pressTimer=setInterval(function(){var E=v>m,C,B,D;C=E?j:g;C=C<0?0:C;B=E?g:j;B=B>x?x:B;j+=(E?u:-u);j=a(j,C,B);D=j/l;if(j==g||j<=C||j>=B){clearInterval(t._pressTimer);t._pressTimer=null}t._syncPosition(p,j);t._syncBarPosition(p,D);t._syncEmbedBarPosition(p,j+D);t._onScrollEnd()},50)}}if(A==h||A==z||A==o||A==q){var t=this,e=A==h||A==z,p=e?"hor":"ver",x=e?t.hLimit:t.vLimit,l=e?t.hRatio:t.vRatio,j=e?t._pos[0]:t._pos[1],m=t._barPos[0];t._pressTimer=setInterval(function(){if(y&&e){m+=(A==h?-k:k);m=a(m,0,w);t._syncBarPosition(p,m);t._syncEmbedBarPosition(p,m);y._doScroll(m/k)}else{var B;if(e){j+=(A==h?-k:k)}else{j+=(A==o?-k:k)}j=a(j,0,x);m=j/l;t._syncPosition(p,j);t._syncBarPosition(p,m);t._syncEmbedBarPosition(p,j+m);t._onScrollEnd()}},50)}},_syncPosition:function(f,j){if(!this._pos){return}var d=f=="hor",i=this.cave,g=this.$n(f),h=this.opts.embed;if(g){j=Math.round(j);this._pos[d?0:1]=j;g.style[d?"left":"top"]=j+"px";if(d&&this.needV){this.$n("ver").style.right=-j+"px";if(h){this.$n("ver-embed").style.right=-j+"px"}}if(!d&&this.needH){this.$n("hor").style.bottom=-j+"px";if(h){this.$n("hor-embed").style.bottom=-j+"px"}}i[d?"scrollLeft":"scrollTop"]=j;var e=this.opts.onSyncPosition;if(e){this.currentPos={x:this._pos[0],y:this._pos[1]};e.call(this)}}},_syncBarPosition:function(f,g){var e=f=="hor",d=this.$n(f+"-indicator");this._barPos[e?0:1]=g;d.style[e?"left":"top"]=g+"px"},_syncEmbedBarPosition:function(e,i){if(this.opts.embed){var d=e=="hor",h=this.$n(e+"-embed"),f=this.opts,g=d?f.startPositionX:f.startPositionY;h.style[d?"left":"top"]=(i+g)+"px"}},_onScrollEnd:function(){var d=this.opts.onScrollEnd;if(d){this.currentPos={x:this._pos[0],y:this._pos[1]};d.call(this)}},redraw:function(k,g){var e=g=="hor",h=this.uid+"-"+g,d=e?"horizontal":"vertical",j=e?"left":"up",i=e?"right":"down",f=[];if(this.opts.embed){f.push('<div id="',h,'-embed" class="z-scrollbar-',d,'-embed"></div>')}f.push('<div id="',h,'" class="z-scrollbar z-scrollbar-',d,'">','<div id="',h,"-",j,'" class="z-scrollbar-',j,'">','<i class="z-icon-caret-',j,'"></i>',"</div>",'<div id="',h,'-wrapper" class="z-scrollbar-wrapper">','<div id="',h,'-indicator" class="z-scrollbar-indicator">','<i class="z-scrollbar-icon z-icon-reorder"></i></div>','<div id="',h,'-rail" class="z-scrollbar-rail"></div>',"</div>",'<div id="',h,"-",i,'" class="z-scrollbar-',i,'">','<i class="z-icon-caret-',i,'"></i>',"</div>","</div>");jq(k).append(f.join(""));f=null}})})(zk);